<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Atendimento – Clínica</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f5f7fa; }
#telefone { width: 95px; }
header { background:#4a90e2; color:#fff; padding:20px; text-align:center; font-size:1.5em; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; }
#abas { padding: 10px 20px; background:#2980b9; position: fixed; top: 60px; left: 0; width: 100%; z-index: 999; }
#abas button { padding:10px 20px; margin-right:5px; border:none; border-radius:4px; background:#2980b9; color:#fff; cursor:pointer; }
#abas button.ativo { background:#27ae60; }
main { padding: 120px 20px 20px 20px; }
.aba { display:none; }
table { width:100%; border-collapse:collapse; background:#fff; margin-top:15px; }
th,td { padding:12px; border-bottom:1px solid #ddd; text-align:center; }
th { background:#eaf0fb; }
.status-confirmado { color:#27ae60; font-weight:bold; }
.status-cancelado { color:#e74c3c; font-weight:bold; }
.status-reagendar { color:#f39c12; font-weight:bold; }
.status-reagendado { color:#8e44ad; font-weight:bold; }
button { padding:6px 12px; border:none; border-radius:4px; cursor:pointer; }
.btn-confirmar { background:#27ae60; color:#fff; }
.btn-falta { background:#e74c3c; color:#fff; }
.btn-editar { background:#f39c12; color:#fff; }
.btn-excluir { background:#e74c3c; color:#fff; }
#agendamento-container, #whats-box { margin-top:20px; background:#fff; padding:15px; border-radius:5px; max-width:720px; }
.whats-msg { background:#e1ffc7; padding:8px; margin-bottom:8px; border-radius:5px; }
#horarios-escolhidos li { margin-bottom:6px; }
#horarios-escolhidos button { margin-left:10px; background:#e74c3c; color:#fff; }
#filtro-data { margin-bottom:20px; }
.nome-vago { color:#e74c3c; font-weight:bold; }
.nome-ok { color:#27ae60; font-weight:bold; }
</style>
</head>
<body>

<header>Painel de Atendimento – Clínica Exemplo</header>

<main>
<div id="abas">
  <button class="ativo" onclick="mostrarAba('agenda', this)">Agenda</button>
  <button onclick="mostrarAba('cadastro', this)">Cadastro</button>
  <button onclick="mostrarAba('vagos', this)">Horários vagos</button>
  <button onclick="mostrarAba('profissionais', this)">Profissionais</button>
  <button onclick="mostrarAba('whatsapp', this)">WhatsApp</button>
  <button onclick="mostrarAba('lista-pacientes', this)">Lista de Pacientes</button>
</div>

<!-- AGENDA -->
<div id="conteudo-agenda" class="aba">
  Filtro por data: <input type="date" id="filtro-data" onchange="atualizarTabela()"><br><br>
  <table id="tabela-pacientes">
    <thead>
      <tr><th>Paciente</th><th>Data</th><th>Hora</th><th>Profissional</th><th>Status</th><th>Ações</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="agendamento-container" style="display:none;">
    <h3 id="titulo-reagendamento"></h3>
    Data: <input type="date" id="data-reagendamento"><br><br>
    <div style="display:flex; gap:30px; flex-wrap:wrap;">
      <div>
        <label>Horário:</label><br>
        <input type="time" id="novo-horario"><br><br>
        <button onclick="adicionarHorario()">Adicionar horário</button>
      </div>
      <div>
        <b>Horários sugeridos:</b>
        <ul id="horarios-escolhidos"></ul>
      </div>
    </div>
    <br>
    <button onclick="enviarSugestao()">Enviar sugestão</button>
  </div>
</div>

<!-- CADASTRO -->
<div id="conteudo-cadastro" class="aba">
<form onsubmit="cadastrarPaciente(event)">
Nome: <input id="nome" required><br><br>
Telefone: <input id="telefone" placeholder="(99)999999999" required><br><br>
Data: <input type="date" id="data" required><br><br>
Hora: <input type="time" id="horario" required><br><br>
Profissional:
<select id="select-profissional" required>
  <option value="">Selecione um profissional</option>
</select>
<br><br>
<button id="btn-cadastrar">Cadastrar</button>
</form>
</div>

<!-- HORÁRIOS VAGOS -->
<div id="conteudo-vagos" class="aba">
<table id="tabela-vagos">
<thead><tr><th>Paciente</th><th>Horário vago</th><th>Data</th><th>Profissional</th><th>Ação</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- PROFISSIONAIS -->
<div id="conteudo-profissionais" class="aba">
<h3>Cadastrar profissional</h3>
<form id="form-prof" onsubmit="adicionarProfissional(event)">
Nome: <input id="nome-prof" required>
Especialidade: <input id="esp-prof" required>
<button>Adicionar</button>
</form>

<table id="tabela-profissionais">
<thead><tr><th>Nome</th><th>Especialidade</th><th>Ações</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- WHATSAPP -->
<div id="conteudo-whatsapp" class="aba">
<div id="whats-box">
<div id="whats-log"></div>
<hr>
<input id="resposta-paciente" placeholder="Digite a resposta">
<button onclick="enviarResposta()">Enviar resposta</button>
</div>
</div>

<!-- LISTA DE PACIENTES -->
<div id="conteudo-lista-pacientes" class="aba">
<h3>Todos os pacientes cadastrados</h3>
<table id="tabela-lista-pacientes">
<thead><tr><th>Nome</th><th>Telefone</th><th>Profissional</th></tr></thead>
<tbody></tbody>
</table>
</div>

</main>

<script>
/* ---------- VARIÁVEIS GLOBAIS ---------- */
let pacientes = [];
let pacienteSelecionado = null;
let horariosSelecionados = [];
const API_BASE = "SUA_API_AQUI"; // Substitua pela URL da sua API

/* ---------- FORMATAÇÃO TELEFONE ---------- */
const telefoneInput = document.getElementById("telefone");
telefoneInput.addEventListener("input", function() {
  let valor = telefoneInput.value.replace(/\D/g, "");
  if(valor.length > 11) valor = valor.slice(0,11);
  if(valor.length > 2) valor = `(${valor.slice(0,2)})${valor.slice(2)}`;
  telefoneInput.value = valor;
});

/* ---------- TROCA DE ABAS ---------- */
function mostrarAba(aba, botao){
 document.querySelectorAll('.aba').forEach(d=>d.style.display='none');
 document.getElementById('conteudo-'+aba).style.display='block';
 document.querySelectorAll('#abas button').forEach(b=>b.classList.remove('ativo'));
 botao.classList.add('ativo');
}

/* ---------- CADASTRAR PACIENTE ---------- */
function cadastrarPaciente(event){
 event.preventDefault();
 const nome = document.getElementById("nome").value;
 const telefone = document.getElementById("telefone").value;
 const data = document.getElementById("data").value;
 const horario = document.getElementById("horario").value;
 const profissional = document.getElementById("select-profissional").value;

 const paciente = {
   id: pacientes.length+1,
   nome, telefone, data, horario, profissional, status:"Aguardando", mensagens:[]
 };
 pacientes.push(paciente);
 carregarPacientes();
 alert("Paciente cadastrado!");
}

/* ---------- ADICIONAR PROFISSIONAL ---------- */
function adicionarProfissional(event){
 event.preventDefault();
 const nome = document.getElementById("nome-prof").value;
 const esp = document.getElementById("esp-prof").value;
 const select = document.getElementById("select-profissional");
 const option = document.createElement("option");
 option.value = nome;
 option.textContent = nome;
 select.appendChild(option);
 document.getElementById("form-prof").reset();
 carregarProfissionais();
}

/* ---------- CARREGAR PROFISSIONAIS ---------- */
function carregarProfissionais(){
 const tbody = document.querySelector("#tabela-profissionais tbody");
 tbody.innerHTML="";
 for(let i=0;i<select.options.length;i++){
   const nome = select.options[i].value;
   if(!nome) continue;
   tbody.innerHTML+=`<tr>
     <td>${nome}</td>
     <td>-</td>
     <td></td>
   </tr>`;
 }
}

/* ---------- CARREGAR PACIENTES ---------- */
function carregarPacientes(){
 const tbody = document.querySelector("#tabela-pacientes tbody");
 const tbodyLista = document.querySelector("#tabela-lista-pacientes tbody");
 tbody.innerHTML="";
 tbodyLista.innerHTML="";
 pacientes.forEach((p,i)=>{
   tbody.innerHTML+=`<tr>
     <td>${p.nome}</td>
     <td>${p.data}</td>
     <td>${p.horario}</td>
     <td>${p.profissional}</td>
     <td class="status-${p.status.toLowerCase()}">${p.status}</td>
     <td>
       <button onclick="abrirReagendamento(${i})" class="btn-editar">Reagendar</button>
       <button onclick="enviarConfirmacao(${i})" class="btn-confirmar">Confirmar</button>
       <button onclick="mostrarWhatsApp(${i})" class="btn-editar">WhatsApp</button>
     </td>
   </tr>`;
   tbodyLista.innerHTML+=`<tr>
     <td>${p.nome}</td>
     <td>${p.telefone}</td>
     <td>${p.profissional}</td>
   </tr>`;
 });
 atualizarVagos();
}

/* ---------- HORÁRIOS VAGOS ---------- */
function atualizarVagos(){
 const tb=document.querySelector("#tabela-vagos tbody");
 tb.innerHTML="";
 pacientes.forEach((p,i)=>{
   if(p.status==="Vago") return;
   if(p.status==="Aguardando"){
     tb.innerHTML+=`
     <tr>
       <td>${p.nome}</td>
       <td>${p.horario}</td>
       <td>${p.data}</td>
       <td>${p.profissional}</td>
       <td><button onclick="marcarHorarioVago(${i})">Marcar como vago</button></td>
     </tr>`;
   }
 });
}

function marcarHorarioVago(i){
 if(confirm("Marcar este horário como vago?")){
   const paciente = pacientes[i];
   paciente.status = "Vago";
   carregarPacientes();
 }
}

/* ---------- REAGENDAMENTO ---------- */
function abrirReagendamento(i){
 pacienteSelecionado = pacientes[i];
 mostrarAba('agenda', document.querySelectorAll('#abas button')[0]);
 document.getElementById("agendamento-container").style.display='block';
 document.getElementById("titulo-reagendamento").textContent=`Reagendar ${pacienteSelecionado.nome}`;
 horariosSelecionados=[];
 document.getElementById("horarios-escolhidos").innerHTML="";
 const dataReagendada = pacienteSelecionado.data.split("/").reverse().join("-");
 document.getElementById("data-reagendamento").value = dataReagendada;
}

function adicionarHorario(){
 const h = document.getElementById("novo-horario").value;
 if(!h) return alert("Escolha um horário.");
 horariosSelecionados.push(h);
 renderHorariosSelecionados();
}

function renderHorariosSelecionados(){
 const ul = document.getElementById("horarios-escolhidos");
 ul.innerHTML="";
 horariosSelecionados.forEach((h,i)=>{
   ul.innerHTML+=`<li>${h} <button onclick="removerHorario(${i})">X</button></li>`;
 });
}

function removerHorario(i){
 horariosSelecionados.splice(i,1);
 renderHorariosSelecionados();
}

function enviarSugestao(){
 if(!pacienteSelecionado) return;
 if(!document.getElementById("data-reagendamento").value) return alert("Escolha uma data.");
 if(horariosSelecionados.length===0) return alert("Adicione pelo menos um horário.");

 pacienteSelecionado.horariosSugestao = horariosSelecionados;
 pacienteSelecionado.dataSugestao = document.getElementById("data-reagendamento").value.split("-").reverse().join("/");
 pacienteSelecionado.status="Reagendar";

 alert("Sugestões enviadas!");
 document.getElementById("agendamento-container").style.display='none';
 carregarPacientes();
}

/* ---------- WHATSAPP SIMULADO ---------- */
function mostrarWhatsApp(i){
 pacienteSelecionado = pacientes[i];
 const log = document.getElementById("whats-log");
 log.innerHTML="";
 if(pacienteSelecionado.mensagens){
   pacienteSelecionado.mensagens.forEach(m=>{
     log.innerHTML+=`<div class="whats-msg">${m}</div>`;
   });
 }
 mostrarAba('whatsapp', document.querySelectorAll('#abas button')[4]);
}

function enviarResposta(){
 const msg = document.getElementById("resposta-paciente").value.trim();
 if(!msg || !pacienteSelecionado) return;
 pacienteSelecionado.mensagens = pacienteSelecionado.mensagens||[];
 pacienteSelecionado.mensagens.push("Clínica: "+msg);

 if(msg.toLowerCase().includes("confirmo")) pacienteSelecionado.status="Confirmado";
 if(msg.toLowerCase().includes("cancel")) pacienteSelecionado.status="Cancelado";
 if(msg.toLowerCase().includes("reagendar")) pacienteSelecionado.status="Reagendar";

 mostrarWhatsApp(pacientes.indexOf(pacienteSelecionado));
 document.getElementById("resposta-paciente").value="";
 carregarPacientes();
}

/* ---------- CONFIRMAÇÃO RÁPIDA ---------- */
function enviarConfirmacao(i){
 const paciente = pacientes[i];
 paciente.status="Confirmado";
 carregarPacientes();
}

/* ---------- FILTRO DATA ---------- */
function atualizarTabela(){
 const filtro = document.getElementById("filtro-data").value;
 const tbody = document.querySelector("#tabela-pacientes tbody");
 tbody.innerHTML="";
 pacientes.forEach((p,i)=>{
   if(filtro && p.data!==filtro) return;
   tbody.innerHTML+=`<tr>
     <td>${p.nome}</td>
     <td>${p.data}</td>
     <td>${p.horario}</td>
     <td>${p.profissional}</td>
     <td class="status-${p.status.toLowerCase()}">${p.status}</td>
     <td>
       <button onclick="abrirReagendamento(${i})" class="btn-editar">Reagendar</button>
       <button onclick="enviarConfirmacao(${i})" class="btn-confirmar">Confirmar</button>
       <button onclick="mostrarWhatsApp(${i})" class="btn-editar">WhatsApp</button>
     </td>
   </tr>`;
 });
 atualizarVagos();
}

/* ---------- INICIALIZAÇÃO ---------- */
mostrarAba('agenda', document.querySelectorAll('#abas button')[0]);
carregarPacientes();
</script>

</body>
</html>
