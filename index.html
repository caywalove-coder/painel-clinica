<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Atendimento – Clínica</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f5f7fa; }
#telefone { width: 95px; }
header { background:#4a90e2; color:#fff; padding:20px; text-align:center; font-size:1.5em; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; }
#abas { padding: 10px 20px; background:#2980b9; position: fixed; top: 60px; left: 0; width: 100%; z-index: 999; }
#abas button { padding:10px 20px; margin-right:5px; border:none; border-radius:4px; background:#2980b9; color:#fff; cursor:pointer; }
#abas button.ativo { background:#27ae60; }
main { padding: 120px 20px 20px 20px; }
.aba { display:none; }
table { width:100%; border-collapse:collapse; background:#fff; margin-top:15px; }
th,td { padding:12px; border-bottom:1px solid #ddd; text-align:center; }
th { background:#eaf0fb; }
.status-confirmado { color:#27ae60; font-weight:bold; }
.status-cancelado { color:#e74c3c; font-weight:bold; }
.status-reagendar { color:#f39c12; font-weight:bold; }
.status-reagendado { color:#8e44ad; font-weight:bold; }
button { padding:6px 12px; border:none; border-radius:4px; cursor:pointer; }
.btn-confirmar { background:#27ae60; color:#fff; }
.btn-falta { background:#e74c3c; color:#fff; }
.btn-editar { background:#f39c12; color:#fff; }
.btn-excluir { background:#e74c3c; color:#fff; }
#agendamento-container, #whats-box { margin-top:20px; background:#fff; padding:15px; border-radius:5px; max-width:720px; }
.whats-msg { background:#e1ffc7; padding:8px; margin-bottom:8px; border-radius:5px; }
#horarios-escolhidos li { margin-bottom:6px; }
#horarios-escolhidos button { margin-left:10px; background:#e74c3c; color:#fff; }
#filtro-data { margin-bottom:20px; }
.nome-vago { color:#e74c3c; font-weight:bold; }
.nome-ok { color:#27ae60; font-weight:bold; }
</style>
</head>
<body>

<header>Painel de Atendimento – Clínica Exemplo</header>
<main>
<div id="abas">
  <button class="ativo" onclick="mostrarAba('agenda', this)">Agenda</button>
  <button onclick="mostrarAba('cadastro', this)">Cadastro</button>
  <button onclick="mostrarAba('vagos', this)">Horários vagos</button>
  <button onclick="mostrarAba('profissionais', this)">Profissionais</button>
  <button onclick="mostrarAba('whatsapp', this)">WhatsApp</button>
  <button onclick="mostrarAba('lista-pacientes', this)">Lista de Pacientes</button>
</div>

<!-- AGENDA -->
<div id="conteudo-agenda" class="aba">
  Filtro por data: <input type="date" id="filtro-data" onchange="atualizarTabela()"><br><br>
  <table id="tabela-pacientes">
    <thead>
      <tr><th>Paciente</th><th>Data</th><th>Hora</th><th>Profissional</th><th>Status</th><th>Ações</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="agendamento-container" style="display:none;">
    <h3 id="titulo-reagendamento"></h3>
    Data: <input type="date" id="data-reagendamento"><br><br>
    <div style="display:flex; gap:30px; flex-wrap:wrap;">
      <div>
        <label>Horário:</label><br>
        <input type="time" id="novo-horario"><br><br>
        <button onclick="adicionarHorario()">Adicionar horário</button>
      </div>
      <div>
        <b>Horários sugeridos:</b>
        <ul id="horarios-escolhidos"></ul>
      </div>
    </div>
    <br>
    <button onclick="enviarSugestao()">Enviar sugestão</button>
  </div>
</div>

<!-- CADASTRO -->
<div id="conteudo-cadastro" class="aba">
<form onsubmit="cadastrarPaciente(event)">
Nome: <input id="nome" required><br><br>
Telefone: <input id="telefone" placeholder="(99)999999999" required><br><br>
<script>
const telefoneInput = document.getElementById("telefone");
telefoneInput.addEventListener("input", function(e) {
  let valor = telefoneInput.value.replace(/\D/g, "");
  if(valor.length > 11) valor = valor.slice(0,11);
  if(valor.length > 2) valor = `(${valor.slice(0,2)})${valor.slice(2)}`;
  telefoneInput.value = valor;
});
</script>
Data: <input type="date" id="data" required><br><br>
Hora: <input type="time" id="horario" required><br><br>
Profissional:
<select id="select-profissional" required>
  <option value="">Selecione um profissional</option>
</select>
<br><br>
<button id="btn-cadastrar">Cadastrar</button>
</form>
</div>

<!-- HORÁRIOS VAGOS -->
<div id="conteudo-vagos" class="aba">
<table id="tabela-vagos">
<thead><tr><th>Paciente</th><th>Horário vago</th><th>Data</th><th>Profissional</th><th>Ação</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- PROFISSIONAIS -->
<div id="conteudo-profissionais" class="aba">
<h3>Cadastrar profissional</h3>
<form id="form-prof" onsubmit="adicionarProfissional(event)">
Nome: <input id="nome-prof" required>
Especialidade: <input id="esp-prof" required>
<button>Adicionar</button>
</form>

<table id="tabela-profissionais">
<thead><tr><th>Nome</th><th>Especialidade</th><th>Ações</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- WHATSAPP -->
<div id="conteudo-whatsapp" class="aba">
<div id="whats-box">
<div id="whats-log"></div>
<hr>
<input id="resposta-paciente" placeholder="Digite a resposta">
<button onclick="enviarResposta()">Enviar resposta</button>
</div>
</div>

<!-- LISTA DE PACIENTES -->
<div id="conteudo-lista-pacientes" class="aba">
  <h3>Todos os pacientes cadastrados</h3>
  <table id="tabela-lista-pacientes">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Telefone</th>
        <th>Profissional</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

</main>

<script>
const API_BASE = "https://694efba7b5bc648a93c1bd3c.mockapi.io/api/v1";

let pacientes = [];
let profissionais = [];
let editandoPaciente = null;
let editandoProfissional = null;
let pacienteSelecionado = null;
let horariosVagos = [];
let horariosSelecionados = [];
let sugestoesAtuais = [];
let dataReagendada = null;

/* ---------- CONTROLE DE ABAS ---------- */
function mostrarAba(a,b){
 document.querySelectorAll('.aba').forEach(x=>x.style.display='none');
 document.querySelectorAll('#abas button').forEach(x=>x.classList.remove('ativo'));
 b.classList.add('ativo');
 document.getElementById('conteudo-'+a).style.display='block';
}

/* ---------- API ---------- */
async function carregarProfissionais(){
 try {
   const res = await fetch(`${API_BASE}/profissionais`);
   profissionais = await res.json();
   renderProfissionais();
   atualizarSelectProfissional();
 } catch(e){ alert("Erro ao carregar profissionais da API"); }
}

async function carregarPacientes(){
 try {
   const res = await fetch(`${API_BASE}/pacientes`);
   pacientes = await res.json();
   atualizarTabela();
   atualizarListaPacientes();
 } catch(e){ alert("Erro ao carregar pacientes da API"); }
}

/* ---------- PROFISSIONAIS ---------- */
function renderProfissionais(){
 const tb=document.querySelector("#tabela-profissionais tbody");
 tb.innerHTML="";
 profissionais.forEach((p,i)=>{
   tb.innerHTML+=`
   <tr>
    <td>${p.nome}</td>
    <td>${p.especialidade}</td>
    <td>
      <button class="btn-editar" onclick="editarProfissional(${i})">Editar</button>
      <button class="btn-excluir" onclick="excluirProfissional(${i})">Excluir</button>
    </td>
   </tr>`; 
 });
}

function atualizarSelectProfissional(){
 const select=document.getElementById("select-profissional");
 select.innerHTML='<option value="">Selecione um profissional</option>';
 profissionais.forEach((p,i)=> select.innerHTML+=`<option value="${i}">${p.nome} (${p.especialidade})</option>`);
}

function adicionarProfissional(e){
 e.preventDefault();
 const nomeInput = document.getElementById("nome-prof");
 const espInput = document.getElementById("esp-prof");
 if(editandoProfissional!==null){
   profissionais[editandoProfissional]={nome:nomeInput.value, especialidade:espInput.value};
   editandoProfissional=null;
 } else {
   profissionais.push({nome:nomeInput.value, especialidade:espInput.value});
 }
nomeInput.value=""; espInput.value="";
renderProfissionais();
atualizarSelectProfissional();
}

/* ---------- PACIENTES ---------- */
function atualizarTabela(){
 const tb=document.querySelector("#tabela-pacientes tbody");
 tb.innerHTML="";
 const filtro=document.getElementById("filtro-data").value;
 const pacientesOrdenados = [...pacientes].sort((a,b)=>{
   const [d1,m1,y1]=a.data.split("/").map(Number);
   const [d2,m2,y2]=b.data.split("/").map(Number);
   const dateA = new Date(y1,m1-1,d1,...a.horario.split(":").map(Number));
   const dateB = new Date(y2,m2-1,d2,...b.horario.split(":").map(Number));
   return dateA - dateB;
 });
 pacientesOrdenados.forEach((p)=>{
   if(filtro && p.data!==filtro.split("-").reverse().join("/")) return;
   const i = pacientes.indexOf(p);
   tb.innerHTML+=`
   <tr>
     <td>${p.nome}</td>
     <td>${p.data}</td>
     <td>${p.horario}</td>
     <td>${p.profissional}</td>
     <td class="status-${p.status.toLowerCase()}">${p.status}</td>
     <td>
       <button class="btn-confirmar" onclick="enviarConfirmacao(${i})">Enviar confirmação</button>
       <button class="btn-editar" onclick="editarPaciente(${i})">Editar</button>
       <button class="btn-excluir" onclick="excluirPaciente(${i})">Excluir</button>
     </td>
   </tr>`;
 });
 atualizarVagos();
}

function atualizarListaPacientes(){
 const tb=document.querySelector("#tabela-lista-pacientes tbody");
 tb.innerHTML="";
 pacientes.forEach(p=>{
   tb.innerHTML+=`<tr>
     <td>${p.nome}</td>
     <td>${p.telefone||""}</td>
     <td>${p.profissional}</td>
   </tr>`;
 });
}

/* ---------- INICIALIZAÇÃO ---------- */
carregarProfissionais();
carregarPacientes();
mostrarAba('agenda',document.querySelectorAll('#abas button')[0]);
</script>
</body>
</html>

