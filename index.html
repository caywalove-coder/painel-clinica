<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Atendimento – Clínica</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f5f7fa; }
#telefone { width: 95px; }
header { background:#4a90e2; color:#fff; padding:20px; text-align:center; font-size:1.5em; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; }
#abas { padding: 10px 20px; background:#2980b9; position: fixed; top: 60px; left: 0; width: 100%; z-index: 999; }
#abas button { padding:10px 20px; margin-right:5px; border:none; border-radius:4px; background:#2980b9; color:#fff; cursor:pointer; }
#abas button.ativo { background:#27ae60; }
main { padding: 120px 20px 20px 20px; }
.aba { display:none; }
table { width:100%; border-collapse:collapse; background:#fff; margin-top:15px; }
th,td { padding:12px; border-bottom:1px solid #ddd; text-align:center; }
th { background:#eaf0fb; }
.status-confirmado { color:#27ae60; font-weight:bold; }
.status-cancelado { color:#e74c3c; font-weight:bold; }
.status-reagendar { color:#f39c12; font-weight:bold; }
.status-reagendado { color:#8e44ad; font-weight:bold; }
button { padding:6px 12px; border:none; border-radius:4px; cursor:pointer; }
.btn-confirmar { background:#27ae60; color:#fff; }
.btn-falta { background:#e74c3c; color:#fff; }
.btn-editar { background:#f39c12; color:#fff; }
.btn-excluir { background:#e74c3c; color:#fff; }
#agendamento-container, #whats-box { margin-top:20px; background:#fff; padding:15px; border-radius:5px; max-width:720px; }
.whats-msg { background:#e1ffc7; padding:8px; margin-bottom:8px; border-radius:5px; }
#horarios-escolhidos li { margin-bottom:6px; }
#horarios-escolhidos button { margin-left:10px; background:#e74c3c; color:#fff; }
#filtro-data { margin-bottom:20px; }
.nome-vago { color:#e74c3c; font-weight:bold; }
.nome-ok { color:#27ae60; font-weight:bold; }
</style>
</head>
<body>

<header>Painel de Atendimento – Clínica Exemplo</header>

<main>
<div id="abas">
  <button class="ativo" onclick="mostrarAba('agenda', this)">Agenda</button>
  <button onclick="mostrarAba('cadastro', this)">Cadastro</button>
  <button onclick="mostrarAba('vagos', this)">Horários vagos</button>
  <button onclick="mostrarAba('profissionais', this)">Profissionais</button>
  <button onclick="mostrarAba('whatsapp', this)">WhatsApp</button>
  <button onclick="mostrarAba('lista-pacientes', this)">Lista de Pacientes</button>
</div>

<!-- AGENDA -->
<div id="conteudo-agenda" class="aba">
  Filtro por data: <input type="date" id="filtro-data" onchange="atualizarTabela()"><br><br>
  <table id="tabela-pacientes">
    <thead>
      <tr><th>Paciente</th><th>Data</th><th>Hora</th><th>Profissional</th><th>Status</th><th>Ações</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="agendamento-container" style="display:none;">
    <h3 id="titulo-reagendamento"></h3>
    Data: <input type="date" id="data-reagendamento"><br><br>
    <div style="display:flex; gap:30px; flex-wrap:wrap;">
      <div>
        <label>Horário:</label><br>
        <input type="time" id="novo-horario"><br><br>
        <button onclick="adicionarHorario()">Adicionar horário</button>
      </div>
      <div>
        <b>Horários sugeridos:</b>
        <ul id="horarios-escolhidos"></ul>
      </div>
    </div>
    <br>
    <button onclick="enviarSugestao()">Enviar sugestão</button>
  </div>
</div>

<!-- CADASTRO -->
<div id="conteudo-cadastro" class="aba">
<form onsubmit="cadastrarPaciente(event)">
Nome: <input id="nome" required><br><br>
Telefone: <input id="telefone" placeholder="(99)999999999" required><br><br>
Data: <input type="date" id="data" required><br><br>
Hora: <input type="time" id="horario" required><br><br>
Profissional:
<select id="select-profissional" required>
  <option value="">Selecione um profissional</option>
</select>
<br><br>
<button id="btn-cadastrar">Cadastrar</button>
</form>
</div>

<!-- HORÁRIOS VAGOS -->
<div id="conteudo-vagos" class="aba">
<table id="tabela-vagos">
<thead><tr><th>Paciente</th><th>Horário vago</th><th>Data</th><th>Profissional</th><th>Ação</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- PROFISSIONAIS -->
<div id="conteudo-profissionais" class="aba">
<h3>Cadastrar profissional</h3>
<form id="form-prof" onsubmit="adicionarProfissional(event)">
Nome: <input id="nome-prof" required>
Especialidade: <input id="esp-prof" required>
<button>Adicionar</button>
</form>

<table id="tabela-profissionais">
<thead><tr><th>Nome</th><th>Especialidade</th><th>Ações</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- WHATSAPP -->
<div id="conteudo-whatsapp" class="aba">
<div id="whats-box">
<div id="whats-log"></div>
<hr>
<input id="resposta-paciente" placeholder="Digite a resposta">
<button onclick="enviarResposta()">Enviar resposta</button>
</div>
</div>

<!-- LISTA DE PACIENTES -->
<div id="conteudo-lista-pacientes" class="aba">
<h3>Todos os pacientes cadastrados</h3>
<table id="tabela-lista-pacientes">
<thead><tr><th>Nome</th><th>Telefone</th><th>Profissional</th></tr></thead>
<tbody></tbody>
</table>
</div>

</main>

<script>
const API_BASE = "https://SEU-MOCKAPI-URL/api"; // substitua pelo seu endpoint real

let pacientes = [];
let profissionais = [];
let pacienteSelecionado = null;

/* ---------- CARREGAR PACIENTES ---------- */
async function carregarPacientes() {
  try {
    const resp = await fetch(`${API_BASE}/pacientes`);
    pacientes = await resp.json();
    atualizarTabela();
    atualizarVagos();
    atualizarListaPacientes();
  } catch (err) {
    console.error("Erro ao carregar pacientes:", err);
  }
}

/* ---------- CARREGAR PROFISSIONAIS ---------- */
async function carregarProfissionais() {
  try {
    const resp = await fetch(`${API_BASE}/profissionais`);
    profissionais = await resp.json();
    const select = document.getElementById("select-profissional");
    select.innerHTML = '<option value="">Selecione um profissional</option>';
    profissionais.forEach(p => {
      select.innerHTML += `<option value="${p.nome}">${p.nome} (${p.especialidade})</option>`;
    });
    atualizarTabelaProfissionais();
  } catch (err) {
    console.error("Erro ao carregar profissionais:", err);
  }
}

/* ---------- ATUALIZAR TABELA ---------- */
function atualizarTabela() {
  const tbody = document.querySelector("#tabela-pacientes tbody");
  tbody.innerHTML = "";
  const filtro = document.getElementById("filtro-data").value;

  pacientes.forEach((p, i) => {
    if (filtro && p.data !== filtro) return;

    tbody.innerHTML += `
      <tr>
        <td>${p.nome}</td>
        <td>${p.data}</td>
        <td>${p.horario}</td>
        <td>${p.profissional}</td>
        <td class="status-${p.status.toLowerCase()}">${p.status}</td>
        <td>
          <button class="btn-confirmar" onclick="enviarConfirmacao(${i})">Confirmar</button>
          <button class="btn-editar" onclick="abrirReagendamento(${i})">Reagendar</button>
          <button class="btn-falta" onclick="mostrarWhatsApp(${i})">WhatsApp</button>
          <button class="btn-excluir" onclick="excluirPaciente(${i})">Excluir</button>
        </td>
      </tr>
    `;
  });
}

/* ---------- ATUALIZAR LISTA DE PACIENTES ---------- */
function atualizarListaPacientes() {
  const tbody = document.querySelector("#tabela-lista-pacientes tbody");
  tbody.innerHTML = "";
  pacientes.forEach(p => {
    tbody.innerHTML += `
      <tr>
        <td>${p.nome}</td>
        <td>${p.telefone}</td>
        <td>${p.profissional}</td>
      </tr>
    `;
  });
}

/* ---------- ATUALIZAR TABELA DE PROFISSIONAIS ---------- */
function atualizarTabelaProfissionais() {
  const tbody = document.querySelector("#tabela-profissionais tbody");
  tbody.innerHTML = "";
  profissionais.forEach((p, i) => {
    tbody.innerHTML += `
      <tr>
        <td>${p.nome}</td>
        <td>${p.especialidade}</td>
        <td><button class="btn-excluir" onclick="excluirProfissional(${i})">Excluir</button></td>
      </tr>
    `;
  });
}

/* ---------- EXCLUIR PACIENTE ---------- */
async function excluirPaciente(i) {
  const paciente = pacientes[i];
  if (!confirm(`Deseja realmente excluir ${paciente.nome}?`)) return;
  try {
    await fetch(`${API_BASE}/pacientes/${paciente.id}`, { method: 'DELETE' });
    await carregarPacientes(); // recarrega do MockAPI
  } catch (err) {
    console.error("Erro ao excluir paciente:", err);
  }
}

/* ---------- EXCLUIR PROFISSIONAL ---------- */
async function excluirProfissional(i) {
  const prof = profissionais[i];
  if (!confirm(`Deseja realmente excluir ${prof.nome}?`)) return;
  try {
    await fetch(`${API_BASE}/profissionais/${prof.id}`, { method: 'DELETE' });
    await carregarProfissionais(); // recarrega do MockAPI
  } catch (err) {
    console.error("Erro ao excluir profissional:", err);
  }
}

/* ---------- CHAMAR AO CARREGAR PÁGINA ---------- */
window.addEventListener("load", async () => {
  await carregarProfissionais();
  await carregarPacientes();
});
</script>


</body>
</html>
